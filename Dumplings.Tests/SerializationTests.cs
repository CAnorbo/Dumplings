using Dumplings.Rpc;
using System;
using System.Collections.Generic;
using System.Text;
using Xunit;

namespace Dumplings.Tests
{
    public class SerializationTests
    {
        [Fact]
        public void CanDeserializeVerboseTransaction()
        {
            var serialized = "7732a03c8cf133e0475ae37e4f2f49ba77beb631378216889e33e9847aa0049b:::0000000000000000002dddc28874e5a9b2b8c285a09af36d094d91045bb054ae:::1232:::1530763257:::01000000081806ad95abe35cbe9c80dfb86ef48643644bf45d919a296a34101f7f5f7cd452060000006b483045022100c3ae8bdcf200d75572b4f033892e689a1649ad32be02f284b7402266c201c72802203ab8b258c008805b6c6b4293558bf5ca0d94d1f698ef41484a16f4f2920a710f0121039c13447ba27388acdc05edf3dc729da109ff9df25089c6ca3684f0f42fc416eeffffffff0318cf24b8145d1b1e9a11e8171dc4db753d6ed2accc2573a4478359dcd4caf2010000006a47304402200a7f8a519b22acc997c414eeb79a801380c6c700fb0663e508d77a14b8140bd9022024efd0393fb68d621259ba30fa9f60a1237b1832898dd2f5f40ee99502822197012103d9fe9ea3398fa424eb7851d20bdc003199bc2ee693475701f7274d566abf0d0effffffffb70568cbba55f24921fb0097b91625bb23829c7bcd7cb2e5aab05e99406362e3070000006b483045022100873e9f661508948549c09f88de7b37c1553e73d3df619960b8940c08a52b62170220470cf03859d3151f95cdc9578ba643a1fbc008303ae2354db41765dca3c51eb40121031f40c64a290a61e09c07519886b8f0268b6d1c48b15df18cfed4a7d2dffe9e1cffffffff0c3601be6354c7806b4d58f41d5a7a41595846bcd703695498f5bc9aa5a8a078010000006b483045022100eb0ee561e1e5a14523f4ae2e3df90846ba3812f437d815840f05e01d7ada957802204329901d0c2d0bf944dedf8777661d4d39b3e78fd8e8e123dfbb32823c28b38e012102fca48dd13bf362cd5bceda69b5bcde9ba6a5ff59998f50f087575588b765bbbfffffffff0b419001f4d2740ce62137f9e47aa153330e157477fd798958f2344445c4a157000000006a47304402202d7722c3952fe2bebf95f4e4867e4f5cb81dcf82e8f133ba11c21b499524243a022011d7d6529a92183c414b5ee598cecac8965b2e81fad207ee043c5ad913c9aae7012102ac0ddf6336a217785d363d5f74380fc4252d81a2848a2aa9a81269a2f59a96abffffffff5da72b800a5762f685830b7150aa816f302ef542c073cbbbdae1d3a0b1de0c64060000006b483045022100be2939f7dd210b858828d71c99c18b9d2dac7f98c7b965e2ed69a875510ffe38022048a4dc5efa3100e22b8bb51e64a716840beb93f7cff4d4607b568181165650bf01210318090161818352ee203d925c8774a8a6992a444db781f29d541a3b684d5ee548ffffffff0c3601be6354c7806b4d58f41d5a7a41595846bcd703695498f5bc9aa5a8a078050000006b483045022100f93659cb4238cb98abfb715551b28468e9fb6fa38cc516cc1147b715caf4608802201bc3f6453080aafece2b35072273e575e99fc8f667dd24f8736c76108654802f012103b7dac034fa732393d19fdf0670d42cf0a2ad7bc8f426beb006cf13707ff7ece9ffffffff7e6bd61e0a6f93c04f4602a81436e9cec8550253745b6aa6bf0d8ef6cde54a70050000006a4730440220300e676ed4700ce71ef60634ea550aac9d971fa23ef64c668054303d4062348002207b759c0fbd4b3b21e01d7f3f1657766774b56d3f965c9faa8925a2777a1b77c0012102fb19c80375fa2ab217157aeeaec16c7416b95eeeea927edab52c9c7d305ee1abffffffff0afe25f604000000001976a91488c947a8c4f2e935c13ee8b4652f41e37e83dc2a88acfe25f604000000001976a9146c7d459a8b835682a026ce048b9c2ec881a12a0188acfe25f604000000001976a914f24657d6e79048d1dc7959dc272bfb31570b6f3088acfe25f604000000001976a914300b88d512738ad92f11743b6cdd661db9bf74c988ac00c04e03000000001976a914a007d99090ec01e43a13706953a69efe0d90b0e688acfe25f604000000001976a914964ffadf3e33730c74484014d06f864b0a68647988acb5150900000000001976a9148c5ca0add7ee7486d301cbe1783a09e6a13d9df288ac04421a01000000001976a9143366e2bbe20d11b7bc2631bf045ad90f688cf2c388acb2bfff00000000001976a9147038bcdbfd774755e9e713b5546bd51d551e8aa988ac22f8ff00000000001976a914eaf8c16b3976d11dc7c1417be3b4027fb4569ce788ac00000000:::52d47c5f7f1f10346a299a915df44b644386f46eb8df809cbe5ce3ab95ad0618-6-100000000+76a91419e63e8d7e9657b91f3db142a111966239721e6388ac+TxPubkeyhash}{f2cad4dc598347a47325ccacd26e3d75dbc41d17e8119a1e1b5d14b824cf1803-1-63640544+76a914dfa7bf346abd72d5bc2f18a4a66ce04afa92b27388ac+TxPubkeyhash}{e3626340995eb0aae5b27ccd7b9c8223bb2516b99700fb2149f255bacb6805b7-7-41979708+76a914a6edd64f58571b70b51c8a0554483e4a6d3c124188ac+TxPubkeyhash}{78a0a8a59abcf598546903d7bc465859417a5a1df4584d6b80c75463be01360c-1-59754628+76a914e216b950e754b850f96b0d003367c40a48a35c5788ac+TxPubkeyhash}{57a1c4454434f2588979fd7774150e3353a17ae4f93721e60c74d2f40190410b-0-100000800+76a9143844f1b5cb2cd77c0804865c3b0795963427264a88ac+TxPubkeyhash}{640cdeb1a0d3e1dabbcb73c042f52e306f81aa50710b8385f662570a802ba75d-6-83833827+76a91448d2f9a54285c0a82333324c1d967125805ebfe188ac+TxPubkeyhash}{78a0a8a59abcf598546903d7bc465859417a5a1df4584d6b80c75463be01360c-5-59754628+76a9144d85041cd632dc8545a8d879c42b995f30e4ec9788ac+TxPubkeyhash}{704ae5cdf68e0dbfa66a5b74530255c8cee93614a802464fc0936f0a1ed66b7e-5-15370723+76a9142a76248704923d50bbae9060c3d2037de733446e88ac+TxPubkeyhash:::83240446+76a91488c947a8c4f2e935c13ee8b4652f41e37e83dc2a88ac+TxPubkeyhash}{83240446+76a9146c7d459a8b835682a026ce048b9c2ec881a12a0188ac+TxPubkeyhash}{83240446+76a914f24657d6e79048d1dc7959dc272bfb31570b6f3088ac+TxPubkeyhash}{83240446+76a914300b88d512738ad92f11743b6cdd661db9bf74c988ac+TxPubkeyhash}{55492608+76a914a007d99090ec01e43a13706953a69efe0d90b0e688ac+TxPubkeyhash}{83240446+76a914964ffadf3e33730c74484014d06f864b0a68647988ac+TxPubkeyhash}{595381+76a9148c5ca0add7ee7486d301cbe1783a09e6a13d9df288ac+TxPubkeyhash}{18498052+76a9143366e2bbe20d11b7bc2631bf045ad90f688cf2c388ac+TxPubkeyhash}{16760754+76a9147038bcdbfd774755e9e713b5546bd51d551e8aa988ac+TxPubkeyhash}{16775202+76a914eaf8c16b3976d11dc7c1417be3b4027fb4569ce788ac+TxPubkeyhash";
            var deserialized = RpcParser.VerboseTransactionInfoFromLine(serialized);
            Assert.NotNull(deserialized.BlockInfo);
            Assert.NotNull(deserialized.BlockInfo.BlockHash);
            Assert.NotNull(deserialized.BlockInfo.BlockIndex);
            Assert.NotNull(deserialized.BlockInfo.BlockTime);
            Assert.NotNull(deserialized.Id);
            Assert.NotEmpty(deserialized.Inputs);
            Assert.NotEmpty(deserialized.Outputs);
            Assert.NotNull(deserialized.Transaction);
            Assert.Equal(deserialized.Id, deserialized.Transaction.GetHash());
        }
    }
}
